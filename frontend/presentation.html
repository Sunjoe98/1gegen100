<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>1 gegen 100 – Präsentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Die Wand</h1>
  <div class="footer">Noch im Spiel: <span id="aliveCount">0</span> / <span id="totalCount">0</span></div>
  <div id="grid" class="grid auto"></div>

  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
  <script>
    const SOCKET_URL = 'https://onegegen100-u6h7.onrender.com';
    const socket = io(SOCKET_URL);

    let cells = new Map();   // number -> div.cell
    let known = new Set();

    function ensureCells(players) {
      const grid = document.getElementById('grid');
      const nums = players.map(p => p.number).sort((a,b)=>a-b);
      nums.forEach(n => {
        if (!known.has(n)) {
          const d = document.createElement('div');
          d.className = 'cell alive';
          d.textContent = n;
          grid.appendChild(d);
          cells.set(n, d);
          known.add(n);
        }
      });
      players.forEach(p => {
        const c = cells.get(p.number);
        if (!c) return;
        c.classList.remove('alive','dead','elim','out');
        c.classList.add(p.alive ? 'alive' : 'out'); // ausgeschiedene permanent rot
      });
    }

    function wait(ms){ return new Promise(r => setTimeout(r, ms)); }

    // Strikt nacheinander: elim (puls) -> out (permanent rot)
    async function animateEliminationSequential(numbers) {
      for (const num of numbers) {
        const c = cells.get(num);
        if (!c) continue;
        c.classList.remove('alive','dead','out');
        c.classList.add('elim');      // kurz rot-puls
        await wait(450);
        c.classList.remove('elim');
        c.classList.add('out');       // permanent rot
        await wait(120);              // kleine Pause bis zum nächsten
      }
    }

    socket.on('stats', ({alive,total}) => {
      document.getElementById('aliveCount').innerText = alive;
      document.getElementById('totalCount').innerText = total;
    });

    socket.on('updatePlayers', (players) => {
      ensureCells(players);
      players.forEach(p => {
        const c = cells.get(p.number);
        if (!c) return;
        if (!c.classList.contains('elim')) { // laufende Anim. nicht überschreiben
          c.classList.remove('alive','dead','out');
          c.classList.add(p.alive ? 'alive' : 'out');
        }
      });
    });

    socket.on('eliminationSequence', async ({ eliminatedNumbers }) => {
      await animateEliminationSequential(eliminatedNumbers);
    });
  </script>
</body>
</html>
